<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Review History - AI Review Generator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .nav-link {
        display: inline-block;
        color: white;
        text-decoration: none;
        background: rgba(255, 255, 255, 0.2);
        padding: 10px 20px;
        border-radius: 20px;
        margin: 10px 5px;
        transition: background 0.3s;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        margin-bottom: 20px;
      }

      .review-item {
        border-bottom: 1px solid #e0e0e0;
        padding: 20px 0;
      }

      .review-item:last-child {
        border-bottom: none;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .business-name {
        font-size: 1.3em;
        font-weight: 600;
        color: #667eea;
      }

      .timestamp {
        color: #666;
        font-size: 0.9em;
      }

      .review-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .meta-tag {
        background: #f0f0f0;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        color: #333;
      }

      .review-text {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        font-size: 1em;
        line-height: 1.6;
        color: #333;
        margin-top: 10px;
      }

      .stats {
        margin-top: 10px;
        font-size: 0.9em;
        color: #666;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-state h2 {
        margin-bottom: 15px;
      }

      .stars {
        color: #ffc107;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìú Review History</h1>
        <p>All generated reviews</p>
        <a href="/" class="nav-link">üè† Back to Generator</a>
        <a href="/health" class="nav-link">üîç API Health</a>
      </div>

      <div class="card">
        {% if reviews %}
        <div
          style="
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
          "
        >
          <h3 style="margin-bottom: 15px; color: #333">
            üì• Download Selected Reviews
          </h3>
          <div style="margin-bottom: 15px">
            <button
              onclick="selectAll()"
              style="
                padding: 8px 20px;
                margin: 0 5px;
                border: 2px solid #667eea;
                background: white;
                color: #667eea;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 600;
              "
            >
              ‚úì Select All
            </button>
            <button
              onclick="deselectAll()"
              style="
                padding: 8px 20px;
                margin: 0 5px;
                border: 2px solid #764ba2;
                background: white;
                color: #764ba2;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 600;
              "
            >
              ‚úó Deselect All
            </button>
          </div>
          <button
            onclick="downloadCSV()"
            style="
              display: inline-block;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 12px 30px;
              border-radius: 25px;
              border: none;
              margin: 5px;
              font-weight: 600;
              cursor: pointer;
            "
          >
            üìä Download CSV
          </button>
          <button
            onclick="downloadPDF()"
            style="
              display: inline-block;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 12px 30px;
              border-radius: 25px;
              border: none;
              margin: 5px;
              font-weight: 600;
              cursor: pointer;
            "
          >
            üìÑ Download PDF
          </button>
        </div>

        <h2 style="margin-bottom: 20px">Total Reviews: {{ reviews|length }}</h2>

        {% for review in reviews|reverse %}
        <div class="review-item">
          <div style="margin-bottom: 10px">
            <label style="cursor: pointer; font-weight: 600; color: #667eea">
              <input
                type="checkbox"
                class="review-checkbox"
                data-index="{{ loop.index0 }}"
                checked
                style="
                  width: 18px;
                  height: 18px;
                  cursor: pointer;
                  margin-right: 8px;
                  vertical-align: middle;
                "
              />
              Select this review
            </label>
          </div>
          <div class="review-header">
            <div class="business-name">{{ review.business_name }}</div>
            <div class="timestamp">{{ review.timestamp }}</div>
          </div>

          <div class="review-meta">
            <span class="meta-tag">{{ review.business_type }}</span>
            <span class="meta-tag">{{ review.category }}</span>
            <span class="meta-tag stars"
              >{{ '‚òÖ' * review.star_rating }}{{ '‚òÜ' * (5 - review.star_rating)
              }}</span
            >
            <span class="meta-tag">{{ review.language }}</span>
            <span class="meta-tag">{{ review.use_case }}</span>
          </div>

          <div class="review-text">{{ review.review }}</div>

          <div class="stats">
            üìä {{ review.char_count }} characters | üî§ {{
            review.token_usage.total_tokens if review.token_usage else 'N/A' }}
            tokens | ü§ñ Method: {{ review.method }}
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <h2>No reviews yet</h2>
          <p>Generate your first review to see it here!</p>
          <a href="/" class="nav-link" style="margin-top: 20px"
            >Generate Review</a
          >
        </div>
        {% endif %}
      </div>
    </div>

    <script>
      function selectAll() {
        document
          .querySelectorAll(".review-checkbox")
          .forEach((cb) => (cb.checked = true));
      }

      function deselectAll() {
        document
          .querySelectorAll(".review-checkbox")
          .forEach((cb) => (cb.checked = false));
      }

      function getSelectedIndices() {
        const selected = [];
        document.querySelectorAll(".review-checkbox:checked").forEach((cb) => {
          selected.push(parseInt(cb.dataset.index));
        });
        return selected;
      }

      function downloadCSV() {
        const selected = getSelectedIndices();
        if (selected.length === 0) {
          alert("‚ö†Ô∏è Please select at least one review to download!");
          return;
        }
        window.location.href = "/download/csv?indices=" + selected.join(",");
      }

      function downloadPDF() {
        const selected = getSelectedIndices();
        if (selected.length === 0) {
          alert("‚ö†Ô∏è Please select at least one review to download!");
          return;
        }
        window.location.href = "/download/pdf?indices=" + selected.join(",");
      }
    </script>
  </body>
</html>
